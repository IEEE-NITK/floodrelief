<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Karnataka Relief</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="css/style.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="img/icon/flood_rescue.png">
</head>

<body class="grey lighten-3">

    <!--Main Navigation-->
    <header>

        <!--Navbar-->
        <nav class="navbar navbar-dark special-color-dark navbar-expand-lg fixed-top scrolling-navbar">
            <div class="container">
                <!-- Navbar brand -->
                <a class="navbar-brand white-text" href="index.html">
                    <img src="img/icon/flood_rescue.png" alt="flood_rescue" height="40"> Karnataka Relief
                </a>

                <!-- Collapse button -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

                <!-- Collapsible content -->
                <div class="collapse navbar-collapse" id="navbarSupportedContent">

                    <!-- Links -->
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link white-text" onclick="logout()">Logout</a>
                        </li>
                    </ul>
                    <!-- Links -->
                </div>
                <!-- Collapsible content -->
            </div>
        </nav>
        <!--/.Navbar-->

    </header>
    <!--Main Navigation-->

    <!--Main layout-->
    <main class="pt-5 mx-lg-5" style="padding-left: 0;">
        <div class="container-fluid mt-5">

            <!-- Heading -->
            <div class="card mb-4 wow fadeIn">

                <!--Card content-->
                <div class="card-body d-sm-flex justify-content-between">

                    <h4 class="mb-2 mb-sm-0 pt-1">
                        <a href="index.html">Flood Relief Karnataka</a>
                        <span>/</span>
                        <span>Admin Dashboard</span>
                    </h4>

                </div>

            </div>
            <!-- Heading -->

            <!--Grid row-->
            <div class="row wow fadeIn">

                <!--Grid column-->
                <div class="col-md-9 mb-4">

                    <!--Card-->
                    <div class="card">

                        <!--Card content-->
                        <div class="card-body">

                            <table id="dtBasicExample" class="table table-striped table-bordered table-sm table-hover">

                                <!-- Table head -->
                                <thead class="blue lighten-4">
                                    <tr>
                                        <th class="th-sm">#
                                            <i class="fa fa-sort float-right" aria-hidden="true"></i>
                                        </th>
                                        <th class="th-sm">Name
                                            <i class="fa fa-sort float-right" aria-hidden="true"></i>
                                        </th>
                                        <th class="th-sm">Location
                                            <i class="fa fa-sort float-right" aria-hidden="true"></i>
                                        </th>
                                        <th class="th-sm">Mobile
                                            <i class="fa fa-sort float-right" aria-hidden="true"></i>
                                        </th>
                                        <th class="th-sm">Requested on
                                            <i class="fa fa-sort float-right" aria-hidden="true"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <!-- /Table head -->
                                <tbody id="dtBasicExampleBody">
                                    <!-- Load data from API -->
                                </tbody>
                            </table>
                            <!--/. Table  -->

                        </div>

                    </div>
                    <!--/.Card-->

                </div>


                <!--Grid column-->

                <!--Grid column-->
                <div class="col-md-3 mb-4">

                    <!--Card-->
                    <div class="card mb-4">

                        <!--Card content-->
                        <div class="card-body">

                            <!-- List group links -->
                            <div class="list-group list-group-flush">
                                <a class="list-group-item list-group-item-action waves-effect">Rescue
                                    <span id="req0" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                                <a class="list-group-item list-group-item-action waves-effect">Water
                                    <span id="req1" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                                <a class="list-group-item list-group-item-action waves-effect">Food
                                    <span id="req2" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                                <a class="list-group-item list-group-item-action waves-effect">Clothing
                                    <span id="req3" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                                <a class="list-group-item list-group-item-action waves-effect">Medicine
                                    <span id="req4" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                                <a class="list-group-item list-group-item-action waves-effect">Utensils
                                    <span id="req5" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                                <a class="list-group-item list-group-item-action waves-effect">Toiletries
                                    <span id="req6" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                                <a class="list-group-item list-group-item-action waves-effect">Other Needs
                                    <span id="req7" class="badge badge-primary badge-pill pull-right"></span>
                                </a>
                            </div>
                            <!-- List group links -->

                        </div>

                    </div>
                    <!--/.Card-->

                </div>
                <!--Grid column-->

            </div>
            <!--Grid row-->

            <!--Grid row-->
            <div class="row wow fadeIn">

                <!--Grid column-->
                <div class="col-md-6 mb-4">

                    <!--Card-->
                    <div class="card">

                        <!-- Card header -->
                        <div class="card-header">Google map</div>
                        <!--Card content-->
                        <div class="card-body">
                            <!--Google map-->
                            <div id="map-container" class="z-depth-1" style="height: 500px"></div>
                        </div>
                    </div>
                    <!--/.Card-->

                </div>
                <!--Grid column-->

            </div>
    </main>
    <!--Main layout-->

    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <!-- Datatables JavaScript -->
    <script type="text/javascript" src="js/addons/datatables.min.js"></script>

    <!-- Initializations -->
    <script type="text/javascript">
        // Animations initialization
        new WOW().init();
        $(document).ready(function () {

            $.ajaxSetup({
                headers: {
                    'Authorization': localStorage.getItem('id_token')
                }
            });

            let data = [];
            $.get("/admin/requests", function (res) {
                console.log(res);
                data = res;
                let reqCount = [0, 0, 0, 0, 0, 0, 0, 0];
                data.forEach(function (item, i) {
                    console.log(item);
                    reqCount[0] += item.rescue;
                    reqCount[1] += item.water;
                    reqCount[2] += item.food;
                    reqCount[3] += item.clothing;
                    reqCount[4] += item.medicine;
                    reqCount[5] += item.utensils;
                    reqCount[6] += item.toiletries;
                    reqCount[7] += item.other_needs != "";

                    // $('<tr>').html(
                    //     $('td').text(i),
                    //     $('td').text(item.name),
                    //     $('td').text(item.location),
                    //     $('td').text(item.phone),
                    //     $('td').text(item.date_added)
                    // ).appendTo('#dtBasicExampleBody');
                    var trString = "<tr><td>" + (i+1) + "</td>" +
                                    "<td>" + item.name + "</td>" +
                                    "<td>" + item.location + "</td>" +
                                    "<td>" + item.phone + "</td>" +
                                    "<td>" + item.date_added + "</td></tr>";
                    $('#dtBasicExampleBody').append(trString)
                });

            $('#dtBasicExample').DataTable();
            $('.dataTables_length').addClass('bs-select');
                const reqItemCount = 8;
                for (let i = 0; i < reqItemCount; ++i) {
                    $('#req' + i).html(reqCount[i]);
                }
            });

        });
    </script>

    <!--Google Maps-->
    <script src="https://maps.google.com/maps/api/js"></script>
    <script>

        //Logout
        function logout() {
            localStorage.removeItem('id_token');
            $(location).attr('href', 'index.html');
        }

        // Regular map
        function regular_map() {
            var var_location = new google.maps.LatLng(12.3375, 75.8069);

            var var_mapoptions = {
                center: var_location,
                zoom: 11
            };

            var var_map = new google.maps.Map(document.getElementById("map-container"),
                var_mapoptions);

            var var_marker = new google.maps.Marker({
                position: var_location,
                map: var_map,
                title: "Karnataka"
            });
        }

        // Initialize maps
        google.maps.event.addDomListener(window, 'load', regular_map);
    </script>

</body>

</html>